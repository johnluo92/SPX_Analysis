2025-12-01 16:59:23,395 - ================================================================================
2025-12-01 16:59:23,396 - ðŸš€ ANOMALY SYSTEM TRAINING
2025-12-01 16:59:23,396 - ================================================================================
2025-12-01 16:59:23,396 - Started: 2025-12-01 16:59:23
2025-12-01 16:59:23,396 - Test Mode: False | Spike Gate: SAFE
2025-12-01 16:59:23,396 - 
================================================================================
2025-12-01 16:59:23,396 - STEP 1: EXTENDING DATABASE
2025-12-01 16:59:23,396 - ================================================================================
2025-12-01 16:59:23,397 - ðŸ”§ Extending schema...
2025-12-01 16:59:23,399 - âœ… Created forecasts table
2025-12-01 16:59:23,399 -   âœ“ anomaly_score_prior_day
2025-12-01 16:59:23,399 -   âœ“ anomaly_alerts_prior_day
2025-12-01 16:59:23,400 -   âœ“ spike_gate_triggered
2025-12-01 16:59:23,400 -   âœ“ spike_gate_action
2025-12-01 16:59:23,401 -   âœ“ spike_gate_original_direction
2025-12-01 16:59:23,401 -   âœ“ spike_gate_original_magnitude
2025-12-01 16:59:23,402 -   âœ“ spike_gate_confidence_boost
2025-12-01 16:59:23,402 - âœ… Added 7 columns
2025-12-01 16:59:23,403 - âœ… Created anomaly_scores table
2025-12-01 16:59:23,407 - âœ… Created indexes
2025-12-01 16:59:23,407 - 
================================================================================
2025-12-01 16:59:23,407 - STEP 2: BUILDING FEATURES
2025-12-01 16:59:23,407 - ================================================================================
2025-12-01 16:59:35,978 - Data: 5340 rows, 353 features
2025-12-01 16:59:35,978 - Range: 2004-09-13 to 2025-12-01
2025-12-01 16:59:35,978 - 
Adding velocity/acceleration features...
2025-12-01 16:59:35,989 - Added 25 spike features â†’ Total: 378
2025-12-01 16:59:35,989 - 
================================================================================
2025-12-01 16:59:35,989 - STEP 3: TRAINING DETECTOR
2025-12-01 16:59:35,989 - ================================================================================
2025-12-01 16:59:35,990 - Selected 165 velocity features
2025-12-01 16:59:35,990 - ðŸŽ¯ TRAINING EOD ANOMALY DETECTOR
2025-12-01 16:59:35,990 - Selected 165 features
2025-12-01 16:59:36,013 - Valid: 165
2025-12-01 16:59:36,045 - Training IsolationForest (contamination=0.05)...
2025-12-01 16:59:36,228 - Thresholds: M=-0.3884 H=-0.3792 C=-0.3744
2025-12-01 16:59:36,229 - Calculating feature importance...
2025-12-01 16:59:37,261 - Top 10:
2025-12-01 16:59:37,262 -    1. correlation_regime                       0.0103
2025-12-01 16:59:37,262 -    2. regime_prob_crisis                       0.0102
2025-12-01 16:59:37,262 -    3. vol_regime                               0.0094
2025-12-01 16:59:37,262 -    4. vix_regime_micro                         0.0094
2025-12-01 16:59:37,262 -    5. cboe_stress_regime                       0.0094
2025-12-01 16:59:37,262 -    6. liquidity_regime                         0.0093
2025-12-01 16:59:37,262 -    7. equity_vol_divergence                    0.0090
2025-12-01 16:59:37,262 -    8. vxtlt_vix_ratio                          0.0090
2025-12-01 16:59:37,262 -    9. regime_change_flag                       0.0089
2025-12-01 16:59:37,262 -   10. trend_regime                             0.0086
2025-12-01 16:59:37,272 - âœ… Saved to models/
2025-12-01 16:59:37,272 - âœ… Saved detector
2025-12-01 16:59:37,272 - 
================================================================================
2025-12-01 16:59:37,272 - STEP 4: CALCULATING SCORES
2025-12-01 16:59:37,272 - ================================================================================
2025-12-01 16:59:37,272 - Calculating scores for 5340 observations...
2025-12-01 16:59:37,345 - Mean=0.4987 Max=0.9500
2025-12-01 16:59:37,346 - ðŸ”„ Backfilling 5340 dates...
2025-12-01 16:59:37,347 - Calculating scores for 5340 observations...
2025-12-01 16:59:37,422 - Mean=0.4987 Max=0.9500
2025-12-01 17:00:02,443 - âœ… Backfilled 5340 scores
2025-12-01 17:00:02,444 - ðŸ”„ Updating forecasts...
2025-12-01 17:00:02,444 - âœ… Updated 0 forecasts
2025-12-01 17:00:02,444 - 
ðŸ“Š Statistics:
2025-12-01 17:00:02,445 -   Mean: 0.4987
2025-12-01 17:00:02,445 -   Max: 0.9500
2025-12-01 17:00:02,445 -   High/Critical: 5340 days (100.0%)
2025-12-01 17:00:02,445 - 
================================================================================
2025-12-01 17:00:02,445 - STEP 5: TESTING SPIKE GATE
2025-12-01 17:00:02,445 - ================================================================================
2025-12-01 17:00:02,445 - SpikeGate: SAFE mode
2025-12-01 17:00:02,445 -   Override DISABLED (log only)
2025-12-01 17:00:02,445 - Calculating scores for 5340 observations...
2025-12-01 17:00:02,516 - Mean=0.4987 Max=0.9500
2025-12-01 17:00:02,517 - 
Testing on 10 high-anomaly dates:
2025-12-01 17:00:02,517 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.927, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,517 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.922, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.918, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.948, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:00:02,518 - 
ðŸ“Š Spike Gate: 8 checks, 0 executed, 8 potential
2025-12-01 17:00:02,518 - 
================================================================================
2025-12-01 17:00:02,518 - STEP 6: VALIDATION (2024-2025)
2025-12-01 17:00:02,518 - ================================================================================
2025-12-01 17:00:02,519 - Calculating scores for 481 observations...
2025-12-01 17:00:02,529 - Mean=0.6072 Max=0.9500
2025-12-01 17:00:02,530 - 
ðŸ“Š Test Period:
2025-12-01 17:00:02,530 -   Days: 481
2025-12-01 17:00:02,530 -   Spikes (>15%): 77
2025-12-01 17:00:02,530 -   High anomaly before spike: 29 (37.7%)
2025-12-01 17:00:02,530 - 
ðŸŽ¯ Improvement: Baseline 3.4% â†’ With anomaly 37.7%
2025-12-01 17:00:02,530 - 
================================================================================
2025-12-01 17:00:02,530 - STEP 7: GENERATING REPORT
2025-12-01 17:00:02,530 - ================================================================================
2025-12-01 17:02:18,226 - ================================================================================
2025-12-01 17:02:18,226 - ðŸš€ ANOMALY SYSTEM TRAINING
2025-12-01 17:02:18,226 - ================================================================================
2025-12-01 17:02:18,226 - Started: 2025-12-01 17:02:18
2025-12-01 17:02:18,226 - Test Mode: False | Spike Gate: SAFE
2025-12-01 17:02:18,227 - 
================================================================================
2025-12-01 17:02:18,227 - STEP 1: EXTENDING DATABASE
2025-12-01 17:02:18,227 - ================================================================================
2025-12-01 17:02:18,227 - ðŸ”§ Extending schema...
2025-12-01 17:02:18,228 - âœ… Created forecasts table
2025-12-01 17:02:18,228 -   âœ“ anomaly_score_prior_day
2025-12-01 17:02:18,228 -   âœ“ anomaly_alerts_prior_day
2025-12-01 17:02:18,229 -   âœ“ spike_gate_triggered
2025-12-01 17:02:18,229 -   âœ“ spike_gate_action
2025-12-01 17:02:18,229 -   âœ“ spike_gate_original_direction
2025-12-01 17:02:18,230 -   âœ“ spike_gate_original_magnitude
2025-12-01 17:02:18,230 -   âœ“ spike_gate_confidence_boost
2025-12-01 17:02:18,230 - âœ… Added 7 columns
2025-12-01 17:02:18,231 - âœ… Created anomaly_scores table
2025-12-01 17:02:18,232 - âœ… Created indexes
2025-12-01 17:02:18,232 - 
================================================================================
2025-12-01 17:02:18,232 - STEP 2: BUILDING FEATURES
2025-12-01 17:02:18,232 - ================================================================================
2025-12-01 17:02:30,588 - Data: 5340 rows, 353 features
2025-12-01 17:02:30,588 - Range: 2004-09-13 to 2025-12-01
2025-12-01 17:02:30,588 - 
Adding velocity/acceleration features...
2025-12-01 17:02:30,600 - Added 25 spike features â†’ Total: 378
2025-12-01 17:02:30,600 - 
================================================================================
2025-12-01 17:02:30,600 - STEP 3: TRAINING DETECTOR
2025-12-01 17:02:30,600 - ================================================================================
2025-12-01 17:02:30,601 - Selected 165 velocity features
2025-12-01 17:02:30,601 - ðŸŽ¯ TRAINING EOD ANOMALY DETECTOR
2025-12-01 17:02:30,601 - Selected 165 features
2025-12-01 17:02:30,625 - Valid: 165
2025-12-01 17:02:30,657 - Training IsolationForest (contamination=0.05)...
2025-12-01 17:02:30,847 - Thresholds: M=-0.3884 H=-0.3792 C=-0.3744
2025-12-01 17:02:30,847 - Calculating feature importance...
2025-12-01 17:02:31,888 - Top 10:
2025-12-01 17:02:31,888 -    1. correlation_regime                       0.0103
2025-12-01 17:02:31,888 -    2. regime_prob_crisis                       0.0102
2025-12-01 17:02:31,888 -    3. vol_regime                               0.0094
2025-12-01 17:02:31,888 -    4. vix_regime_micro                         0.0094
2025-12-01 17:02:31,888 -    5. cboe_stress_regime                       0.0094
2025-12-01 17:02:31,888 -    6. liquidity_regime                         0.0093
2025-12-01 17:02:31,888 -    7. equity_vol_divergence                    0.0090
2025-12-01 17:02:31,888 -    8. vxtlt_vix_ratio                          0.0090
2025-12-01 17:02:31,888 -    9. regime_change_flag                       0.0089
2025-12-01 17:02:31,888 -   10. trend_regime                             0.0086
2025-12-01 17:02:31,897 - âœ… Saved to models/
2025-12-01 17:02:31,898 - âœ… Saved detector
2025-12-01 17:02:31,898 - 
================================================================================
2025-12-01 17:02:31,898 - STEP 4: CALCULATING SCORES
2025-12-01 17:02:31,898 - ================================================================================
2025-12-01 17:02:31,898 - Calculating scores for 5340 observations...
2025-12-01 17:02:31,985 - Mean=0.4987 Max=0.9500
2025-12-01 17:02:31,985 - ðŸ”„ Backfilling 5340 dates...
2025-12-01 17:02:31,985 - Calculating scores for 5340 observations...
2025-12-01 17:02:32,053 - Mean=0.4987 Max=0.9500
2025-12-01 17:02:56,457 - âœ… Backfilled 5340 scores
2025-12-01 17:02:56,458 - ðŸ”„ Updating forecasts...
2025-12-01 17:02:56,458 - âœ… Updated 0 forecasts
2025-12-01 17:02:56,459 - 
ðŸ“Š Statistics:
2025-12-01 17:02:56,459 -   Mean: 0.4987
2025-12-01 17:02:56,459 -   Max: 0.9500
2025-12-01 17:02:56,459 -   High/Critical: 5340 days (100.0%)
2025-12-01 17:02:56,459 - 
================================================================================
2025-12-01 17:02:56,459 - STEP 5: TESTING SPIKE GATE
2025-12-01 17:02:56,459 - ================================================================================
2025-12-01 17:02:56,459 - SpikeGate: SAFE mode
2025-12-01 17:02:56,459 -   Override DISABLED (log only)
2025-12-01 17:02:56,459 - Calculating scores for 5340 observations...
2025-12-01 17:02:56,538 - Mean=0.4987 Max=0.9500
2025-12-01 17:02:56,539 - 
Testing on 10 high-anomaly dates:
2025-12-01 17:02:56,539 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.927, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,540 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.922, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,540 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.918, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,540 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,540 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_NEUTRAL (score=0.948, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,540 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,541 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,541 - ðŸ’¡ [SAFE MODE] Would trigger OVERRIDE_TO_UP (score=0.950, dir=DOWN, regime=Normal)
2025-12-01 17:02:56,541 - 
ðŸ“Š Spike Gate: 8 checks, 0 executed, 8 potential
2025-12-01 17:02:56,541 - 
================================================================================
2025-12-01 17:02:56,541 - STEP 6: VALIDATION (2024-2025)
2025-12-01 17:02:56,541 - ================================================================================
2025-12-01 17:02:56,541 - Calculating scores for 481 observations...
2025-12-01 17:02:56,552 - Mean=0.6072 Max=0.9500
2025-12-01 17:02:56,552 - 
ðŸ“Š Test Period:
2025-12-01 17:02:56,552 -   Days: 481
2025-12-01 17:02:56,552 -   Spikes (>15%): 77
2025-12-01 17:02:56,552 -   High anomaly before spike: 29 (37.7%)
2025-12-01 17:02:56,552 - 
ðŸŽ¯ Improvement: Baseline 3.4% â†’ With anomaly 37.7%
2025-12-01 17:02:56,552 - 
================================================================================
2025-12-01 17:02:56,552 - STEP 7: GENERATING REPORT
2025-12-01 17:02:56,552 - ================================================================================
2025-12-01 17:02:56,553 - âœ… Saved report
2025-12-01 17:02:56,553 - 
================================================================================
2025-12-01 17:02:56,553 - âœ… COMPLETE
2025-12-01 17:02:56,553 - ================================================================================
2025-12-01 17:02:56,553 - Finished: 2025-12-01 17:02:56
2025-12-01 17:02:56,553 - 
Next Steps:
2025-12-01 17:02:56,553 - 1. Review: models/anomaly_integration_report.json
2025-12-01 17:02:56,553 - 2. Validate spike detection improved
2025-12-01 17:02:56,553 - 3. Update SPIKE_GATE_CONFIG['current_mode'] when ready
