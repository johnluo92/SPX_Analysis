<!DOCTYPE html>
<html>
<head>
    <title>Chart Template - Data Service Integration</title>
    <script src="../../data_service.js"></script>
</head>
<body>
    <div id="chart"></div>
    
    <script>
        // ====================================================================
        // STEP 1: Initialize Data Service (ONCE per page)
        // ====================================================================
        async function initChart() {
            try {
                // Initialize data service (loads both JSON files in parallel)
                await window.dataService.init();
                console.log('‚úÖ Data loaded');
                
                // ================================================================
                // STEP 2: Get data for your chart
                // ================================================================
                
                // For live/current data:
                const anomaly = window.dataService.getAnomalyState();
                const market = window.dataService.getMarketState();
                
                console.log('Current Score:', anomaly.score);
                console.log('Current VIX:', market.vix_close);
                console.log('Active Detectors:', anomaly.activeDetectors);
                
                // For historical data:
                const historical = window.dataService.getHistoricalData();
                
                console.log('Dates:', historical.dates.length);
                console.log('Scores:', historical.scores.length);
                
                // For thresholds:
                const thresholds = window.dataService.getThresholds();
                console.log('Moderate Threshold:', thresholds.base.moderate);
                
                // ================================================================
                // STEP 3: Build your chart with the data
                // ================================================================
                buildChart({
                    currentScore: anomaly.score,
                    classification: anomaly.classification,
                    historicalData: historical,
                    thresholds: thresholds.base
                });
                
                // ================================================================
                // STEP 4: Listen for data refreshes (optional)
                // ================================================================
                window.dataService.on('data-refreshed', (data) => {
                    console.log('üîÑ Data refreshed, updating chart...');
                    updateChart(data.live);
                });
                
            } catch (error) {
                console.error('‚ùå Failed to initialize:', error);
                document.getElementById('chart').innerHTML = 
                    '<div class="error">Failed to load data</div>';
            }
        }
        
        function buildChart(data) {
            // Your Plotly/D3/Chart.js code here
            console.log('Building chart with:', data);
        }
        
        function updateChart(liveData) {
            // Update chart with refreshed data
            console.log('Updating chart with:', liveData);
        }
        
        // Initialize on page load
        initChart();
    </script>
</body>
</html>
