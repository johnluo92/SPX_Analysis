<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector Ranking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemBox, 'Segoe UI', Roboto, sans-serif;
            background: transparent;
            color: #e0e0e0;
        }
        
        .detector-bars-container {
            padding: 24px;
        }
        
        .detector-bar-item {
            margin-bottom: 12px;
            position: relative;
        }
        
        .detector-bar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .detector-bar-name {
            font-size: 12px;
            font-weight: 600;
            color: #e0e0e0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detector-bar-score {
            font-size: 14px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
        }
        
        .detector-bar-background {
            height: 28px;
            background: rgba(20, 20, 30, 0.8);
            border-radius: 6px;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
        }
        
        .detector-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
        }
        
        .detector-bar-fill.high {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }
        
        .detector-bar-fill.moderate {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }
        
        .detector-bar-fill.normal {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }
        
        .detector-bar-label {
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="detectorBars" class="detector-bars-container"></div>

    <script>
        const DOMAIN_NAMES = {
            'vix_mean_reversion': 'VIX Mean Reversion',
            'vix_momentum': 'VIX Momentum',
            'vix_regime_structure': 'VIX Regime Structure',
            'cboe_options_flow': 'CBOE Options Flow',
            'vix_spx_relationship': 'VIX-SPX Relationship',
            'spx_price_action': 'SPX Price Action',
            'spx_volatility_regime': 'SPX Volatility Regime',
            'macro_rates': 'Macro & Rates',
            'commodities_stress': 'Commodities Stress',
            'cross_asset_divergence': 'Cross-Asset Divergence'
        };
        
        async function loadData() {
            try {
                const timestamp = Date.now();
                const anomaly = await fetch(`../../json_data/anomaly_report.json?t=${timestamp}`).then(r => r.json());
                renderDetectorBars(anomaly);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function renderDetectorBars(anomaly) {
            const domainAnomalies = anomaly.domain_anomalies;
            
            const detectors = Object.entries(DOMAIN_NAMES)
                .map(([key, name]) => {
                    const domain = domainAnomalies[key];
                    if (!domain) return null;
                    return { key, name, score: domain.score };
                })
                .filter(d => d !== null)
                .sort((a, b) => b.score - a.score);
            
            const html = detectors.map(detector => {
                const score = detector.score;
                const level = score >= 0.70 ? 'high' : score >= 0.50 ? 'moderate' : 'normal';
                const levelText = score >= 0.70 ? 'HIGH' : score >= 0.50 ? 'MODERATE' : 'NORMAL';
                const scoreColor = score >= 0.70 ? '#ef4444' : score >= 0.50 ? '#f59e0b' : '#10b981';
                const widthPercent = score * 100;
                
                return `
                    <div class="detector-bar-item">
                        <div class="detector-bar-header">
                            <div class="detector-bar-name">${detector.name}</div>
                            <div class="detector-bar-score" style="color: ${scoreColor}">${score.toFixed(3)}</div>
                        </div>
                        <div class="detector-bar-background">
                            <div class="detector-bar-fill ${level}" style="width: ${widthPercent}%">
                                <div class="detector-bar-label">${levelText}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('detectorBars').innerHTML = html;
        }
        
        loadData();
        setInterval(loadData, 15 * 60 * 1000);
    </script>
</body>
</html>